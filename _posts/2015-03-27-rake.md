---
layout: post
title: Rake and Bake
---

![Alt Jim](/../img/jim-weirich.jpg)

**3.27.15** 19:57

Rake is a task manager and build automation tool similar to Make but written in Ruby, created by Jim Weirich (above). Rakefiles (like Makefiles) allow you to create tasks, describe dependencies, and  group tasks in a namespace.

You can create rules in Rakefiles that will tell Rake how to handle files, or you can define behavior in separate files for tasks. When creating a Rails app for example, Rake tasks usually go in the /lib/tasks directory, while the Rakefile is in the root directory of the app.  

A common use for rake is to migrate data into a database, with the terminal command

{% highlight bash %}
$ rake db:migrate
{% endhighlight %}

You can also specify your dev environment with the parameter:

{% highlight bash %}
$ rake db:migrate RAILS_ENV=test
{% endhighlight %}

Code sample from a typical Rakefile:

{% highlight ruby %}
# Add your own tasks in files placed in lib/tasks ending in .rake,
# for example lib/tasks/capistrano.rake, and they will automatically be available to Rake.

require File.expand_path('../config/application', __FILE__)

Rails.application.load_tasks
{% endhighlight %}

Here is a rake task that I recently wrote with a collaborator for a Rails app that we are building. It calls out to an API, and then parses the data into ActiveRecord objects which we use to seed our database.

{% highlight ruby %}

task :fetch => [:environment] do 
  temp = HTTParty.get('https://data.cityofnewyork.us/resource/j8gx-kc43.json')
  parsed_json = JSON.parse(temp.body)
  parsed_json.each do |hash|

    accepts_ebt = hash["facilityaddinfo"].match(/No EBT Accepted/) ? false : true

    if Market.all.nil?
      Market.create(:name => hash["facilityname"], :address => hash["facilitystreetname"], :zipcode => hash["facilityzipcode"], :latitude => hash["latitude"], :longitude => hash["longitude"], :accepts_ebt => accepts_ebt)
    else
      market_names = Market.all.each_with_object([]){|market, array| array << market.name}

      Market.create(:name => hash["facilityname"], :address => hash["facilitystreetname"], :zipcode => hash["facilityzipcode"], :latitude => hash["latitude"], :longitude => hash["longitude"], :accepts_ebt => accepts_ebt) if !market_names.include?(hash["facilityname"])
    end
  end
end

{% endhighlight %}

Like most tools, Rake is capable of a lot more than you will likely need it do to for you, especially if you are just starting out. But some of its features are pretty powerful, such as the ability to automate tests for your code. For more documentation check out [Martin Fowler's guide](http://martinfowler.com/articles/rake.htm) and the [official docs.](http://rake.rubyforge.org/)
